``iLPSD`` ：功率谱估计
=====================================

构造对数均匀的频率点进行功率谱密度估计。


使用说明
-------------------------------------

.. code-block::

    iLPSD(data,fs)            
    iLPSD(data,fs,Name,Value) 
    h = iLPSD(data,fs,_)      
    [pxx,f] = iLPSD(data,fs,_)


- ``iLPSD(data,fs)`` 计算数据的功率谱密度并绘图。
- ``iLPSD(data,fs,Name,Value)`` 计算数据功率谱并绘图，并使用键值对参数进行额外设置。
- ``h = iLPSD(data,fs,_)`` 当有一个输出时，绘图并输出图形句柄。
- ``[pxx,f] = iLPSD(data,fs,_)`` 当有两个输出时，分别输出功率谱密度和相应的频率。



-----


输入参数
-------------------------------------

data
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

原始数据，向量或矩阵：

- 为向量时，直接计算功率谱密度；
- 为矩阵时，按列计算功率谱密度。 


fs
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

数据采样率，以 :math:`\mathrm{Hz}` 为单位，标量。



-----

键值对参数
-------------------------------------

Jdes
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

期望的频率点数，为整数，默认值为 1000。

该参数用于控制 LPSD 算法输出的频率点数，值越大则计算功率谱密度所采用的频率点数越多、结果越趋近于周期图法。应当注意：LPSD 在构造对数均匀的频率点时，根据频率分辨率对频点进行了修正，所以实际用于计算的频率点会小于 ``Jdes`` 设定值，实际计算的频率点也不是严格呈现对数均匀。频率点修正采用了迭代算法，所以无法准确设置频率点数。


Kdes
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

期望的分段次数，为整数，默认值为 100。

该参数用于控制 LPSD 算法中期望的分段次数，用于控制中频段的频率点修正，一般可不做修改。


ksai
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

分段数据的重叠率，0~1 之间标量，默认值为 0.5。

这个参数本来应该名为 `xi` （希腊字母 :math:`\xi`），这里继承了高中最喜欢的数学老师的口音，权且算是彩蛋吧哈哈。


win
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

功率谱估计所用的窗函数，为函数句柄或匿名函数，默认为汗宁窗 ``@hann`` 。

如果使用其他窗函数，可以使用 ``@`` 声明函数句柄，如 ``@hamming`` 使用海明窗。采用这种方式可支持自定义函数，要求自定义窗函数仅接收窗长作为输入参数，输出相应的窗值序列，且输出为列向量。


其他绘图控制
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

本函数支持其他绘图控制参数，如 ``LineWidth`` 、 ``LineStyle`` 等，详见 `plot 帮助文档 <https://ww2.mathworks.cn/help/matlab/ref/plot.html?lang=en>`_ 。


----


输出参数
-------------------------------------

h
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

当输出参数只有一个时，输出该曲线句柄。在曲线关闭之前，可以分别使用 ``h.XData`` 和 ``h.YData`` 获取频率和（开方后的）功率谱密度值。也可以使用曲线句柄的方式对曲线进行调整，详见 `曲线属性 <https://ww2.mathworks.cn/help/matlab/ref/matlab.graphics.primitive.line-properties.html?lang=en>`_ 。

pxx
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

当输出参数有两个时，该参数为第一个输出，是计算的功率谱密度值，其单位为 :math:`\mathrm{*^/Hz^2}` 。当输入参数为矩阵时，该输出也为矩阵。 ``pxx`` 的每列对应 ``data`` 每列的功率谱密度。

f
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

当输出参数有两个时，该参数为第二个输出，是功率谱密度对应的频率点，单位为 :math:`\mathrm{Hz}` 。

----



使用示例
-------------------------------------

.. code-block:: matlab

    ASD = @(f) 0.07./f + 1;
    fs = 10;
    N = 1e4;
    x = genNoise(ASD,fs,N);                 % 生成噪声

    figure
    iLPSD(x,fs)
    hold on
    grid on
    iLPSD(x,fs,'Jdes',3e3)
    iLPSD(x,fs,'win',@hamming,'LineStyle','--')
    xlabel('Frequency (Hz)')
    ylabel('ASD')



----



参考资料
-------------------------------------

#. Michael Tröbs, Gerhard Heinzel. `Improved spectrum estimation from digitized time series on a logarithmic frequency axis <https://www.sciencedirect.com/science/article/pii/S026322410500117X>`_. Measurement. 2005.
#. `LPSD 功率谱估计 <https://ichunyu.github.io/dsp/lpsd.html>`_ . 某春雨的后花园.