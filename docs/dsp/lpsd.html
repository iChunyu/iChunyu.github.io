

<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>LPSD 功率谱估计 &mdash; 某春雨的后花园  文档</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
  <link rel="stylesheet" href="../_static/mystyle.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../_static/misaka.ico"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
        <script src="../_static/translations.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="LaTeX 学习记录" href="../latex/index.html" />
    <link rel="prev" title="信号的滤波" href="filter_design.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> 某春雨的后花园
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="在文档中搜索" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">目录</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../misc/index.html">杂乱的技能树</a></li>
<li class="toctree-l1"><a class="reference internal" href="../control/index.html">控制理论学习记录</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">数字信号处理</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="kalman_filter.html">卡尔曼滤波</a></li>
<li class="toctree-l2"><a class="reference internal" href="signal_diff.html">信号的微分</a></li>
<li class="toctree-l2"><a class="reference internal" href="filter_design.html">信号的滤波</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">LPSD 功率谱估计</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">常用功率谱估计算法</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id2">LPSD算法</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id3">对数频率的选取</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id4">数据的分段处理</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id5">功率谱的归一化</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id6">不同算法的对比</a></li>
<li class="toctree-l3"><a class="reference internal" href="#matlab">MATLAB源码</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../latex/index.html">LaTeX 学习记录</a></li>
<li class="toctree-l1"><a class="reference internal" href="../matlab/index.html">MATLAB 使用技巧</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">某春雨的后花园</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">数字信号处理</a> &raquo;</li>
        
      <li>LPSD 功率谱估计</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/dsp/lpsd.rst.txt" rel="nofollow"> 查看页面源码</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="lpsd">
<h1>LPSD 功率谱估计<a class="headerlink" href="#lpsd" title="永久链接至标题">¶</a></h1>
<p>欧洲航空局（ESA）为LISA计划设计了完整的数据处理工具包 <a class="reference external" href="https://www.elisascience.org/ltpda/">LTPDA</a> （LISA Technology Package Data
Analysis），该工具包中内置一种对数频率点功率谱估计算法，即 LPSD 算法。该算法由文献 <a class="reference external" href="https://www.sciencedirect.com/science/article/pii/S026322410500117X">Improved spectrum estimation from digitized time series on a logarithmic frequency axis</a> 给出。本文作为对该文献学习的总结，基于 MATLAB 自编了 LPSD 算法的功率谱估计函数。</p>
<hr class="docutils" />
<div class="section" id="id1">
<h2>常用功率谱估计算法<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h2>
<p>功率谱估计是频域分析的一种常用手段，可用来检测信号中的单频信号或评估仪器的噪声本底等。常用的功率谱估计算法有周期图法（对应 MATLAB 函数为 <code class="docutils literal notranslate"><span class="pre">periodogram</span></code> ）和 Welch 方法（ <code class="docutils literal notranslate"><span class="pre">pwelch</span></code> ）。对于采集系统收集到的数字信号，周期图法会对该数据进行加窗，然后利用快速傅里叶变换（FFT）将信号转化到频域</p>
<div class="math notranslate nohighlight">
\[X(k) = \sum\limits_{n = 0}^{N - 1} {x(n){e^{ - i\frac{ {2\pi} } {N}nk}}}\]</div>
<p>然后利用 Parseval 等式即可获得功率谱</p>
<div class="math notranslate nohighlight">
\[S(k) = \frac{2}{Nf_s}|X(k)|^2\]</div>
<p>式中，系数 <span class="math notranslate nohighlight">\(2\)</span> 将双边谱转换到单边谱，这是因为负频率不具备实际的物理意义。</p>
<div class="figure align-center" style="width: 70%">
<img alt="../_images/lpsd01.jpg" src="../_images/lpsd01.jpg" />
</div>
<p>Welch 方法相对于周期图法增加了分段平均的思想，其将数据等分为多段，并且允许各段数据之间具有一定的重叠率以补偿窗函数引入的数据不平权的影响。对每段数据采用周期图法，最后将各段分别计算的功率谱进算数平均，获得最终的谱估计值。</p>
<div class="figure align-center" style="width: 70%">
<img alt="../_images/lpsd02.jpg" src="../_images/lpsd02.jpg" />
</div>
<p>上图展示了周期图法和 Welch 方法对功率谱估计的结果。其中，蓝色曲线的周期图法一次性使用了全部的数据，因而有最高的频率分辨率，可以看到更低的频带。但是其高频部分的数据波动较大，且波动范围不会随着点数的增加而减小，即不满足所谓的一致性原则。橙色的 Welch 算法由于对数据进行了分段，直接进行 FFT 的数据相对较少，导致频率分辨率降低。但是分段平均使得高频波动的幅值大大减小，可以验证高频波动会随着分段次数的增加而进一步减小。</p>
</div>
<div class="section" id="id2">
<h2>LPSD算法<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h2>
<p>LPSD 算法的基本思想是采用对数分布的频率点，由于此时频率点的差值不是定值，即 DFT 的频率分辨率随频率点变化，因而在求取每个频率点对应的功率谱密度时应当对原始数据进行不同的分段。这就是说，LPSD 算法的每个频率点对应于不同分段次数下 Welch 算法中的相应点。</p>
<div class="section" id="id3">
<h3>对数频率的选取<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h3>
<p>记采集到的离散数据为 <span class="math notranslate nohighlight">\(x(n),n=0,1,2...N-1\)</span> ，采样率为 <span class="math notranslate nohighlight">\(f_s\)</span> 。假设希望计算 <span class="math notranslate nohighlight">\(J_{des}\)</span> 个点，其中第 <span class="math notranslate nohighlight">\(j\)</span> 个点对应的频率为 <span class="math notranslate nohighlight">\(f(j)\)</span> 、功率谱密度为 <span class="math notranslate nohighlight">\(P(j)\)</span> 、频率分辨率为 <span class="math notranslate nohighlight">\(r(j)=f(j+1)-f(j)\)</span> 。应当注意的是，这里的频率分辨率是指计算DFT的频率点之间的间隔，更一般的说法应当是栅栏效应。有限长数据的频率分辨率实际由DTFT定义，与数据的时间长度互为导数，本文中称之为最小分辨率。在LPSD算法中不能采用 <code class="docutils literal notranslate"><span class="pre">logspace</span></code> 生成对数分布的频率点，因为数值计算的频率间隔不应当小于最小分辨率 <span class="math notranslate nohighlight">\(r_{min}\)</span> ，否则这种计算是没有意义的。</p>
<div class="figure align-center" style="width: 70%">
<img alt="../_images/lpsd03.jpg" src="../_images/lpsd03.jpg" />
</div>
<p>为了计算频率点，首先考察严格对数均匀的频率点应当满足</p>
<div class="math notranslate nohighlight">
\[\log f(j + 1) - \log f(j) = C\]</div>
<p>其中C为常数。频率范围受分辨率和采样率的影响，取</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{gathered}
    f(1) = {r_{min}} = \frac{{{f_s}}}{N} \\
    f({J_{des}}) = {f_{max}} = \frac{{{f_s}}}{2}
\end{gathered}\end{split}\]</div>
<p>再令</p>
<div class="math notranslate nohighlight">
\[g=\log f_{max}- \log r_{min}=\log \frac{N}{2}\]</div>
<p>可以得到第 <span class="math notranslate nohighlight">\(j\)</span> 个点的频率和频率分辨率分别为</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{gathered}
    f(j) = {r_{min}} \times {10^{\frac{{j - 1}}{{{J_{des}} - 1}}g}} \\
    {r_0}(j) = f(j)({10^{\frac{g}{{{J_{des}} - 1}}}} - 1) \\
\end{gathered}\end{split}\]</div>
<p>为了使低频段到高频段的频率分辨率变化较连续，对中频段对应的频率分辨率进行调整，为此，引入分段次数期望值 <span class="math notranslate nohighlight">\(K_{des}\)</span> （其典型值为100），在分段重叠率为 <span class="math notranslate nohighlight">\(\xi\)</span> 时满足</p>
<div class="math notranslate nohighlight">
\[({K_{des}} - 1)(1 - \xi ){L_{avg}} + {L_{avg}} = N\]</div>
<p>此时对应的频率分辨率为</p>
<div class="math notranslate nohighlight">
\[r_{avg}=\frac{f_s}{L_{avg}}=\frac{f_s}{N}\left[ (K_{des}-1)(1-\xi) +1 \right]\]</div>
<p>根据分辨率限制和算法需求，我们需要对频率分辨率进行调整，如下</p>
<div class="math notranslate nohighlight">
\[\begin{split}r'(j) = \left\{ {\begin{array}{*{20}{l}}
    {{r_0}(j)}&amp;{,{r_0}(j) \geqslant {r_{avg}}} \\
    {\sqrt {{r_0}(j) \cdot {r_{avg}}} }&amp;{,{r_0}(j) &lt; {r_{avg}}{\text{ and }}\sqrt {{r_0}(j) \cdot {r_{avg}}}  &gt; {r_{\min }}} \\
    {{r_{min}}}&amp;{,else}
\end{array}} \right.\end{split}\]</div>
<p>除此之外，为了保证依据频率分辨率分段的数据长度为整数，频率分辨率还应当做进一步调整</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{gathered}
    L(j) = \left\lfloor {\frac{{{f_s}}}{{r'(j)}}} \right\rfloor  \\
    r(j) = \frac{{{f_s}}}{{L(j)}} \\
\end{gathered}\end{split}\]</div>
<p>其中，符号 <span class="math notranslate nohighlight">\(\left\lfloor \right\rfloor\)</span> 表示向下取整。</p>
<p>综上所述，对数频率的选取算法为：以 <span class="math notranslate nohighlight">\(f(1)=r_{min}\)</span> 为起点，根据频率和 <span class="math notranslate nohighlight">\(J_{des}\)</span> 求解分辨率 <span class="math notranslate nohighlight">\(r_0(j)\)</span> ，并根据要求对分辨率进行调整，得到 <span class="math notranslate nohighlight">\(r(j)\)</span> ，接着利用 <span class="math notranslate nohighlight">\(f(j+1)=f(j)+r(j)\)</span> 进行迭代。当计算的频率达到奈奎斯特频率即可停止迭代。值得注意的是，由于对频率分辨率进行了修正，获得的频率点并不是严格的对数分布，同时也会导致实际获得的频率点 <span class="math notranslate nohighlight">\(J\)</span> 与期望的点数 <span class="math notranslate nohighlight">\(J_{des}\)</span> 并不相等。</p>
</div>
<div class="section" id="id4">
<h3>数据的分段处理<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h3>
<p>对于第 <span class="math notranslate nohighlight">\(j\)</span> 个频率点，由前可知其频率分辨率为 <span class="math notranslate nohighlight">\(r(j)\)</span> ，分段后的每段数据长度为 <span class="math notranslate nohighlight">\(L(j)\)</span> 。为了减小窗函数导致的数据不等权，允许分段之间存在一定的重叠率 <span class="math notranslate nohighlight">\(\xi\)</span> ，数据分段如下图所示。</p>
<div class="figure align-center" style="width: 70%">
<img alt="../_images/lpsd04.jpg" src="../_images/lpsd04.jpg" />
</div>
<p>由图可知，每段数据未重叠部分长度为</p>
<div class="math notranslate nohighlight">
\[D(j) = (1 - \xi ) \cdot L(j)\]</div>
<p>因而分段次数为</p>
<div class="math notranslate nohighlight">
\[K(j) = \left\lfloor {\frac{N - L(j)} {D(j) + 1} } \right\rfloor\]</div>
<p>针对每段数据，我们可以选择利用 <code class="docutils literal notranslate"><span class="pre">mean</span></code> 函数求取数据平均值后予以扣除，或利用 <code class="docutils literal notranslate"><span class="pre">detrend</span></code> 函数直接去除数据中线性漂移。以扣除平均值为例，第 <span class="math notranslate nohighlight">\(j\)</span> 个频率点的第 <span class="math notranslate nohighlight">\(k\)</span> 段数据平均值为</p>
<div class="math notranslate nohighlight">
\[a(j,k) = \frac{1}{L(j)}\sum\limits_{l = 1}^{L(j)} {x\left( {D(j) \cdot (k - 1) + l} \right)}\]</div>
<p>将该段数据扣除平均值后，以相同长度的窗函数 <span class="math notranslate nohighlight">\(w(j,l)\)</span> 对数据段进行加窗，得到预处理的数据段</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}{r}
    G(j,k,l) = \left[ {x\left( {D(j) \cdot (k - 1) + l} \right) - a(j,k)} \right] \cdot w(j,l)\\
    l = 1,2,3...L(j)
\end{array}\end{split}\]</div>
<p>然后对 <span class="math notranslate nohighlight">\(G(j,k,l)\)</span> 进行离散傅里叶变换</p>
<div class="math notranslate nohighlight">
\[A(j,k) = \sum\limits_{l = 1}^{L(j)} {G(j,k,l) \cdot {e^{ - 2\pi i\frac{m(j)}{L(j)}l} } }\]</div>
<p>应当注意的是 <span class="math notranslate nohighlight">\(G(j,k,l)\)</span> 中 <span class="math notranslate nohighlight">\(j\)</span> 表示频率点、 <span class="math notranslate nohighlight">\(k\)</span> 表示分段、 <span class="math notranslate nohighlight">\(l\)</span> 代表数据在分段内的位置，因此 <span class="math notranslate nohighlight">\(l\)</span> 对应傅里叶变换的时间变量。严格来说，上式是离散傅里叶变换第 <span class="math notranslate nohighlight">\(m(j)\)</span> 个点的值。其中</p>
<div class="math notranslate nohighlight">
\[m(j)=\frac{f(j)}{r(j)}\]</div>
<p>在 FFT 算法中， <span class="math notranslate nohighlight">\(m(j)\)</span> 应当是整数，而此处不一定满足该要求，故LPSD算法不能利用FFT进行加速，这是该算法耗时较长的原因之一。对 <span class="math notranslate nohighlight">\(m(j)\)</span> 的具体讨论详见文献，此处不作赘述。</p>
<p>在进行以上操作后，我们得到了第 <span class="math notranslate nohighlight">\(j\)</span> 个频率点对应的 <span class="math notranslate nohighlight">\(K(j)\)</span> 段数据DFT的 <span class="math notranslate nohighlight">\(K(j)\)</span> 个单点值，对这些值进行算数平均，根据Parseval等式可得谱密度为</p>
<div class="math notranslate nohighlight">
\[P(j) = \frac{C}{K(j)}\sum\limits_{k = 1}^{K(j)} { { {\left| {A(j,k)} \right|}^2} }\]</div>
<p>其中 <span class="math notranslate nohighlight">\(C\)</span> 为归一化系数，由下一节进行讨论。</p>
</div>
<div class="section" id="id5">
<h3>功率谱的归一化<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h3>
<p>功率谱的归一化系数与窗函数相关，而窗函数可根据不同需求进行不同的选择。对于任意窗函数 <span class="math notranslate nohighlight">\(w(j,l)\)</span> ，做如下定义</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{gathered}
    {S_1}(j) = \sum\limits_{l = 1}^{L(j)} {w(j,l)}  \\
    {S_2}(j) = \sum\limits_{l = 1}^{L(j)} {{w^2}(j,l)}  \\
\end{gathered}\end{split}\]</div>
<p>单边谱的归一化系数可按下式进行计算</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{gathered}
    {C_{PS}}(j) = \frac{2}{{S_1^2(j)}} \\
    {C_{PSD}}(j) = \frac{2}{{{f_s} \cdot {S_2}(j)}} \\
\end{gathered}\end{split}\]</div>
<p>其中， <span class="math notranslate nohighlight">\(C_{PS}\)</span> 是功率谱的归一化系数，常用于单频信号的处理。由于绝大多数信号都均匀丰富的频率成分，我们更多地采用功率谱密度，其对于的归一化系数为 <span class="math notranslate nohighlight">\(C_{PSD}\)</span> 。以电压为例，功率谱的单位是 <span class="math notranslate nohighlight">\({\rm V}^2\)</span> ，而功率谱密度的单位是 <span class="math notranslate nohighlight">\({\rm V}^2/{\rm Hz}\)</span> 。在习惯上，我们所说的功率谱指的都是功率谱密度，且取其开方值，单位为 <span class="math notranslate nohighlight">\({\rm V}/\sqrt{ {\rm Hz} }\)</span> 。</p>
<p>至此，我们依据实现的功率谱的求取，以 <span class="math notranslate nohighlight">\(f(j)\)</span> 为横轴， <span class="math notranslate nohighlight">\(P(j)\)</span> 为纵轴即可绘制功率谱。</p>
</div>
</div>
<div class="section" id="id6">
<h2>不同算法的对比<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h2>
<p>依然以本文开头的数据为例，周期图法、Welch 方法以及 LPSD 算法得到的功率谱如下图所示。</p>
<div class="figure align-center" style="width: 70%">
<img alt="../_images/lpsd05.jpg" src="../_images/lpsd05.jpg" />
</div>
<p>可见，LPSD 算法在低频出有更高的频率分辨率，在高频对谱密度的估计更准确，兼顾了周期图法和 Welch 方法的优点。然而 LPSD 算法牺牲了数值计算的速度，在一次利用400万个数据做谱的测试中，各算法的耗时如下。其中 <code class="docutils literal notranslate"><span class="pre">iParLPSD</span></code> 是利用了 MATLAB 并行工具包计算的 LPSD 算法。</p>
<div class="figure align-center" style="width: 70%">
<img alt="../_images/lpsd06.jpg" src="../_images/lpsd06.jpg" />
</div>
</div>
<div class="section" id="matlab">
<h2>MATLAB源码<a class="headerlink" href="#matlab" title="永久链接至标题">¶</a></h2>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="c">% Use LPSD mothod to plot power spectral density</span><span class="w"></span>
<span class="c">% [Pxx,f] = iLPSD(Data,fs,Jdes)</span><span class="w"></span>
<span class="c">%    Data --- Input data, processed by column</span><span class="w"></span>
<span class="c">%    fs   --- Sample frequency, unit: Hz</span><span class="w"></span>
<span class="c">%    Jdes --- Desired frequency points, default: 1000</span><span class="w"></span>
<span class="c">%    Pxx  --- One-sided PSD, unit: *^2/Hz</span><span class="w"></span>
<span class="c">%    f    --- Frequency points related to PSD points, unit: Hz</span><span class="w"></span>
<span class="c">%    Default window function is hanning window.</span><span class="w"></span>
<span class="c">% Demo:</span><span class="w"></span>
<span class="c">%    iLPSD(data,fs)</span><span class="w"></span>
<span class="c">%       Plot PSD using default settings.</span><span class="w"></span>
<span class="c">%    h = iLPSD(data,fs,Jdes)</span><span class="w"></span>
<span class="c">%       Plot PSD with desired points of 1000</span><span class="w"></span>
<span class="c">%    [Pxx,f] = iLPSD(data,fs)</span><span class="w"></span>
<span class="c">%       Return PSD points, not plot any figure</span><span class="w"></span>

<span class="c">% Ref: Improved spectrum estimation from digitized time series on a logarithmic frequency axis</span><span class="w"></span>
<span class="c">%      Article DOI: 10.1016/j.measurement.2005.10.010</span><span class="w"></span>

<span class="c">% XiaoCY 2020-04-21</span><span class="w"></span>

<span class="c">%% Main</span><span class="w"></span>
<span class="k">function</span><span class="w"> </span>varargout<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">iLPSD</span><span class="p">(</span>varargin<span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="nb">nargoutchk</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="nb">narginchk</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="n">data</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">varargin</span><span class="p">{</span><span class="mi">1</span><span class="p">};</span><span class="w"></span>
<span class="w">    </span><span class="n">fs</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">varargin</span><span class="p">{</span><span class="mi">2</span><span class="p">};</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">nargin</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">3</span><span class="w"></span>
<span class="w">        </span><span class="n">Jdes</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">varargin</span><span class="p">{</span><span class="mi">3</span><span class="p">};</span><span class="w"></span>
<span class="w">    </span><span class="k">else</span><span class="w"></span>
<span class="w">        </span><span class="n">Jdes</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1000</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>

<span class="w">    </span><span class="n">Kdes</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">ksai</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">0.5</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="p">[</span><span class="n">N</span><span class="p">,</span><span class="n">nCol</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">size</span><span class="p">(</span><span class="n">data</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">N</span><span class="o">==</span><span class="mi">1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">nCol</span><span class="o">~=</span><span class="mi">1</span><span class="w"></span>
<span class="w">       </span><span class="n">data</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">data</span><span class="o">&#39;</span><span class="p">;</span><span class="w"></span>
<span class="w">       </span><span class="n">N</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">nCol</span><span class="p">;</span><span class="w"></span>
<span class="w">       </span><span class="n">nCol</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>

<span class="w">    </span><span class="p">[</span><span class="n">f</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">m</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">getFreqs</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">fs</span><span class="p">,</span><span class="n">Jdes</span><span class="p">,</span><span class="n">Kdes</span><span class="p">,</span><span class="n">ksai</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="n">J</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">length</span><span class="p">(</span><span class="n">f</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">P</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">zeros</span><span class="p">(</span><span class="n">J</span><span class="p">,</span><span class="n">nCol</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nb">j</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span><span class="n">J</span><span class="w"></span>
<span class="w">        </span><span class="n">Dj</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">floor</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">ksai</span><span class="p">)</span><span class="o">*</span><span class="n">L</span><span class="p">(</span><span class="nb">j</span><span class="p">));</span><span class="w"></span>
<span class="w">        </span><span class="n">Kj</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">floor</span><span class="p">((</span><span class="n">N</span><span class="o">-</span><span class="n">L</span><span class="p">(</span><span class="nb">j</span><span class="p">))</span><span class="o">/</span><span class="n">Dj</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">w</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">hann</span><span class="p">(</span><span class="n">L</span><span class="p">(</span><span class="nb">j</span><span class="p">));</span><span class="w"></span>
<span class="w">        </span><span class="n">C_PSD</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">2</span><span class="o">/</span><span class="n">fs</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">w</span><span class="o">.^</span><span class="mi">2</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">l</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">L</span><span class="p">(</span><span class="nb">j</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">&#39;</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">W1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">cos</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="nb">pi</span><span class="o">*</span><span class="n">m</span><span class="p">(</span><span class="nb">j</span><span class="p">)</span><span class="o">/</span><span class="n">L</span><span class="p">(</span><span class="nb">j</span><span class="p">)</span><span class="o">.*</span><span class="n">l</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">W2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">sin</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="nb">pi</span><span class="o">*</span><span class="n">m</span><span class="p">(</span><span class="nb">j</span><span class="p">)</span><span class="o">/</span><span class="n">L</span><span class="p">(</span><span class="nb">j</span><span class="p">)</span><span class="o">.*</span><span class="n">l</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">A</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nCol</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span><span class="p">:</span><span class="n">Kj</span><span class="o">-</span><span class="mi">1</span><span class="w"></span>
<span class="w">            </span><span class="n">G</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">data</span><span class="p">(</span><span class="n">k</span><span class="o">*</span><span class="n">Dj</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">k</span><span class="o">*</span><span class="n">Dj</span><span class="o">+</span><span class="n">L</span><span class="p">(</span><span class="nb">j</span><span class="p">),:);</span><span class="w"></span>
<span class="w">            </span><span class="n">G</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">G</span><span class="o">-</span><span class="nb">mean</span><span class="p">(</span><span class="n">G</span><span class="p">);</span><span class="w">        </span><span class="c">% G = detrend(G);</span><span class="w"></span>
<span class="w">            </span><span class="n">G</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">G</span><span class="o">.*</span><span class="n">w</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="n">A</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">sum</span><span class="p">(</span><span class="n">G</span><span class="o">.*</span><span class="n">W1</span><span class="p">)</span><span class="o">.^</span><span class="mi">2</span><span class="o">+</span><span class="nb">sum</span><span class="p">(</span><span class="n">G</span><span class="o">.*</span><span class="n">W2</span><span class="p">)</span><span class="o">.^</span><span class="mi">2</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">end</span><span class="w"></span>
<span class="w">        </span><span class="n">P</span><span class="p">(</span><span class="nb">j</span><span class="p">,:)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">A</span><span class="o">/</span><span class="n">Kj</span><span class="o">*</span><span class="n">C_PSD</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>

<span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="nb">nargout</span><span class="w"></span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">            </span><span class="n">PlotPSD</span><span class="p">(</span><span class="n">P</span><span class="p">,</span><span class="n">f</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">            </span><span class="nb">varargout</span><span class="p">{</span><span class="mi">1</span><span class="p">}</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">PlotPSD</span><span class="p">(</span><span class="n">P</span><span class="p">,</span><span class="n">f</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>
<span class="w">            </span><span class="nb">varargout</span><span class="p">{</span><span class="mi">1</span><span class="p">}</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">P</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="nb">varargout</span><span class="p">{</span><span class="mi">2</span><span class="p">}</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">f</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">otherwise</span><span class="w"></span>
<span class="w">            </span><span class="c">% Do Nothing</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>

<span class="c">%% Subfunctions</span><span class="w"></span>
<span class="c">% get logarithmic frequency points</span><span class="w"></span>
<span class="k">function</span><span class="w"> </span>[f,L,m]<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">getFreqs</span><span class="p">(</span>N,fs,Jdes,Kdes,ksai<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">fmin</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">fs</span><span class="o">/</span><span class="n">N</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">fmax</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">fs</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">r_avg</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">fs</span><span class="o">/</span><span class="n">N</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">ksai</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Kdes</span><span class="o">-</span><span class="mi">1</span><span class="p">));</span><span class="w"></span>

<span class="w">    </span><span class="n">g</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="n">N</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>^<span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">Jdes</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="n">f</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">zeros</span><span class="p">(</span><span class="n">Jdes</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">L</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">f</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">m</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">f</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="nb">j</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">fj</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">fmin</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="n">fj</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">fmax</span><span class="w"></span>
<span class="w">        </span><span class="n">rj</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">fj</span><span class="o">*</span><span class="n">g</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">rj</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">r_avg</span><span class="w"></span>
<span class="w">            </span><span class="n">rj</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">sqrt</span><span class="p">(</span><span class="n">rj</span><span class="o">*</span><span class="n">r_avg</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="k">end</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">rj</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">fmin</span><span class="w"></span>
<span class="w">            </span><span class="n">rj</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">fmin</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">end</span><span class="w"></span>

<span class="w">        </span><span class="n">Lj</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">floor</span><span class="p">(</span><span class="n">fs</span><span class="o">/</span><span class="n">rj</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">rj</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">fs</span><span class="o">/</span><span class="n">Lj</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">mj</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">fj</span><span class="o">/</span><span class="n">rj</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="n">f</span><span class="p">(</span><span class="nb">j</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">fj</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">L</span><span class="p">(</span><span class="nb">j</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">Lj</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">m</span><span class="p">(</span><span class="nb">j</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">mj</span><span class="p">;</span><span class="w"></span>

<span class="w">        </span><span class="n">fj</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">fj</span><span class="o">+</span><span class="n">rj</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="nb">j</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">j</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="w">    </span><span class="n">f</span><span class="p">(</span><span class="n">f</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[];</span><span class="w"></span>
<span class="w">    </span><span class="n">L</span><span class="p">(</span><span class="n">L</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[];</span><span class="w"></span>
<span class="w">    </span><span class="n">m</span><span class="p">(</span><span class="n">m</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[];</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>

<span class="c">% plot PSD</span><span class="w"></span>
<span class="k">function</span><span class="w"> </span>varargout<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">PlotPSD</span><span class="p">(</span>P,f<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">hLine</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">loglog</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="nb">sqrt</span><span class="p">(</span><span class="n">P</span><span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="n">grid</span><span class="w"> </span><span class="s">on</span><span class="w"></span>
<span class="w">    </span><span class="nb">xlabel</span><span class="p">(</span><span class="s">&#39;Frequency (Hz)&#39;</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="nb">ylabel</span><span class="p">(</span><span class="s">&#39;PSD ([Unit]/Hz^{1/2})&#39;</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">nargout</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">        </span><span class="nb">varargout</span><span class="p">{</span><span class="mi">1</span><span class="p">}</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">hLine</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="../latex/index.html" class="btn btn-neutral float-right" title="LaTeX 学习记录" accesskey="n" rel="next">下一页 <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="filter_design.html" class="btn btn-neutral float-left" title="信号的滤波" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> 上一页</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; 版权所有 2021, 大春雨.

    </p>
  </div>
    
    
    
    利用 <a href="https://www.sphinx-doc.org/">Sphinx</a> 构建，使用了 
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">主题</a>
    
    由 <a href="https://readthedocs.org">Read the Docs</a>开发. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>